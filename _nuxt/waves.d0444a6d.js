THREE.SpriteCanvasMaterial=function(R){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(R)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=!0;THREE.SpriteCanvasMaterial.prototype.clone=function(){var R=new THREE.SpriteCanvasMaterial;return R.copy(this),R.color.copy(this.color),R.program=this.program,R};THREE.CanvasRenderer=function(R){console.log("THREE.CanvasRenderer",THREE.REVISION),R=R||{};var D=this,J,te,K,ee=new THREE.Projector,P=R.canvas!==void 0?R.canvas:document.createElement("canvas"),oe=P.width,E=P.height,z=Math.floor(oe/2),V=Math.floor(E/2),Be=0,C=0,ge=oe,be=E,ie=1,r=P.getContext("2d",{alpha:R.alpha===!0}),ae=new THREE.Color(16711680),he=1,me=1,k=0,j=null,Q=null,We=null,ke=null,Ee=null,Ne=[],T,_,N,ue,ve,re,ne,Ce,B,A=new THREE.Color,_e=new THREE.Color,ze=new THREE.Color,Ae=new THREE.Color,xe={},se,Fe,Xe,Ie,De,n,f,y=new THREE.Box2,p=new THREE.Box2,g=new THREE.Box2,F=new THREE.Color,U=new THREE.Color,u=new THREE.Color,M=new THREE.Vector3,b=new THREE.Vector3,W=new THREE.Vector3,m=new THREE.Matrix3;r.setLineDash===void 0&&(r.setLineDash=function(){}),this.domElement=P,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return r},this.getContextAttributes=function(){return r.getContextAttributes()},this.getPixelRatio=function(){return ie},this.setPixelRatio=function(e){e!==void 0&&(ie=e)},this.setSize=function(e,a,l){oe=e*ie,E=a*ie,P.width=oe,P.height=E,z=Math.floor(oe/2),V=Math.floor(E/2),l!==!1&&(P.style.width=e+"px",P.style.height=a+"px"),y.min.set(-z,-V),y.max.set(z,V),p.min.set(-z,-V),p.max.set(z,V),me=1,k=0,j=null,Q=null,We=null,ke=null,Ee=null,this.setViewport(0,0,e,a)},this.setViewport=function(e,a,l,o){Be=e*ie,C=a*ie,ge=l*ie,be=o*ie},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,a){ae.set(e),he=a!==void 0?a:1,p.min.set(-z,-V),p.max.set(z,V)},this.setClearColorHex=function(e,a){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,a)},this.getClearColor=function(){return ae},this.getClearAlpha=function(){return he},this.getMaxAnisotropy=function(){return 0},this.clear=function(){p.isEmpty()===!1&&(p.intersect(y),p.expandByScalar(2),p.min.x=p.min.x+z,p.min.y=-p.min.y+V,p.max.x=p.max.x+z,p.max.y=-p.max.y+V,he<1&&r.clearRect(p.min.x|0,p.max.y|0,p.max.x-p.min.x|0,p.min.y-p.max.y|0),he>0&&(L(THREE.NormalBlending),pe(1),Y("rgba("+Math.floor(ae.r*255)+","+Math.floor(ae.g*255)+","+Math.floor(ae.b*255)+","+he+")"),r.fillRect(p.min.x|0,p.max.y|0,p.max.x-p.min.x|0,p.min.y-p.max.y|0)),p.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,a){if(a.isCamera===void 0){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}var l=e.background;l&&l.isColor?(Y("rgb(0,0,0)"),r.fillRect(0,0,oe,E)):this.autoClear===!0&&this.clear(),D.info.render.vertices=0,D.info.render.faces=0,r.setTransform(ge/oe,0,0,-be/E,Be,E-C),r.translate(z,V),J=ee.projectScene(e,a,this.sortObjects,this.sortElements),te=J.elements,K=J.lights,m.getNormalMatrix(a.matrixWorldInverse),t();for(var o=0,v=te.length;o<v;o++){var c=te[o],s=c.material;if(!(s===void 0||s.opacity===0)){if(g.makeEmpty(),c instanceof THREE.RenderableSprite)T=c,T.x*=z,T.y*=V,ye(T,c,s);else if(c instanceof THREE.RenderableLine)T=c.v1,_=c.v2,T.positionScreen.x*=z,T.positionScreen.y*=V,_.positionScreen.x*=z,_.positionScreen.y*=V,g.setFromPoints([T.positionScreen,_.positionScreen]),y.intersectsBox(g)===!0&&He(T,_,c,s);else if(c instanceof THREE.RenderableFace){if(T=c.v1,_=c.v2,N=c.v3,T.positionScreen.z<-1||T.positionScreen.z>1||_.positionScreen.z<-1||_.positionScreen.z>1||N.positionScreen.z<-1||N.positionScreen.z>1)continue;T.positionScreen.x*=z,T.positionScreen.y*=V,_.positionScreen.x*=z,_.positionScreen.y*=V,N.positionScreen.x*=z,N.positionScreen.y*=V,s.overdraw>0&&(I(T.positionScreen,_.positionScreen,s.overdraw),I(_.positionScreen,N.positionScreen,s.overdraw),I(N.positionScreen,T.positionScreen,s.overdraw)),g.setFromPoints([T.positionScreen,_.positionScreen,N.positionScreen]),y.intersectsBox(g)===!0&&d(T,_,N,0,1,2,c,s)}p.union(g)}}r.setTransform(1,0,0,1,0,0)};function t(){F.setRGB(0,0,0),U.setRGB(0,0,0),u.setRGB(0,0,0);for(var e=0,a=K.length;e<a;e++){var l=K[e],o=l.color;l.isAmbientLight?F.add(o):l.isDirectionalLight?U.add(o):l.isPointLight&&u.add(o)}}function w(e,a,l){for(var o=0,v=K.length;o<v;o++){var c=K[o];if(Ae.copy(c.color),c.isDirectionalLight){var s=M.setFromMatrixPosition(c.matrixWorld).normalize(),i=a.dot(s);if(i<=0)continue;i*=c.intensity,l.add(Ae.multiplyScalar(i))}else if(c.isPointLight){var s=M.setFromMatrixPosition(c.matrixWorld),i=a.dot(M.subVectors(s,e).normalize());if(i<=0||(i*=c.distance==0?1:1-Math.min(e.distanceTo(s)/c.distance,1),i==0))continue;i*=c.intensity,l.add(Ae.multiplyScalar(i))}}}function ye(e,a,l){pe(l.opacity),L(l.blending);var o=a.scale.x*z,v=a.scale.y*V,c=Math.sqrt(o*o+v*v);if(g.min.set(e.x-c,e.y-c),g.max.set(e.x+c,e.y+c),l.isSpriteMaterial){var s=l.map;if(s!==null){var i=xe[s.id];if((i===void 0||i.version!==s.version)&&(i=X(s),xe[s.id]=i),i.canvas!==void 0){Y(i.canvas);var H=s.image,G=H.width*s.offset.x,q=H.height*s.offset.y,Z=H.width*s.repeat.x,O=H.height*s.repeat.y,le=o/Z,de=v/O;r.save(),r.translate(e.x,e.y),l.rotation!==0&&r.rotate(l.rotation),r.translate(-o/2,-v/2),r.scale(le,de),r.translate(-G,-q),r.fillRect(G,q,Z,O),r.restore()}}else Y(l.color.getStyle()),r.save(),r.translate(e.x,e.y),l.rotation!==0&&r.rotate(l.rotation),r.scale(o,-v),r.fillRect(-.5,-.5,1,1),r.restore()}else l.isSpriteCanvasMaterial?(Re(l.color.getStyle()),Y(l.color.getStyle()),r.save(),r.translate(e.x,e.y),l.rotation!==0&&r.rotate(l.rotation),r.scale(o,v),l.program(r),r.restore()):l.isPointsMaterial&&(Y(l.color.getStyle()),r.save(),r.translate(e.x,e.y),l.rotation!==0&&r.rotate(l.rotation),r.scale(o*l.size,-v*l.size),r.fillRect(-.5,-.5,1,1),r.restore())}function He(e,a,l,o){if(pe(o.opacity),L(o.blending),r.beginPath(),r.moveTo(e.positionScreen.x,e.positionScreen.y),r.lineTo(a.positionScreen.x,a.positionScreen.y),o.isLineBasicMaterial){if(fe(o.linewidth),$(o.linecap),Le(o.linejoin),o.vertexColors!==THREE.VertexColors)Re(o.color.getStyle());else{var v=l.vertexColors[0].getStyle(),c=l.vertexColors[1].getStyle();if(v===c)Re(v);else{try{var s=r.createLinearGradient(e.positionScreen.x,e.positionScreen.y,a.positionScreen.x,a.positionScreen.y);s.addColorStop(0,v),s.addColorStop(1,c)}catch{s=v}Re(s)}}r.stroke(),g.expandByScalar(o.linewidth*2)}else o.isLineDashedMaterial&&(fe(o.linewidth),$(o.linecap),Le(o.linejoin),Re(o.color.getStyle()),Ye([o.dashSize,o.gapSize]),r.stroke(),g.expandByScalar(o.linewidth*2),Ye([]))}function d(e,a,l,o,v,c,s,i){if(D.info.render.vertices+=3,D.info.render.faces++,pe(i.opacity),L(i.blending),ue=e.positionScreen.x,ve=e.positionScreen.y,re=a.positionScreen.x,ne=a.positionScreen.y,Ce=l.positionScreen.x,B=l.positionScreen.y,S(ue,ve,re,ne,Ce,B),(i.isMeshLambertMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial)&&i.map===null)_e.copy(i.color),ze.copy(i.emissive),i.vertexColors===THREE.FaceColors&&_e.multiply(s.color),A.copy(F),b.copy(e.positionWorld).add(a.positionWorld).add(l.positionWorld).divideScalar(3),w(b,s.normalModel,A),A.multiply(_e).add(ze),i.wireframe===!0?x(A,i.wireframeLinewidth,i.wireframeLinecap,i.wireframeLinejoin):h(A);else if(i.isMeshBasicMaterial||i.isMeshLambertMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial)if(i.map!==null){var H=i.map.mapping;H===THREE.UVMapping&&(se=s.uvs,ce(ue,ve,re,ne,Ce,B,se[o].x,se[o].y,se[v].x,se[v].y,se[c].x,se[c].y,i.map))}else i.envMap!==null?i.envMap.mapping===THREE.SphericalReflectionMapping&&(W.copy(s.vertexNormalsModel[o]).applyMatrix3(m),Fe=.5*W.x+.5,Xe=.5*W.y+.5,W.copy(s.vertexNormalsModel[v]).applyMatrix3(m),Ie=.5*W.x+.5,De=.5*W.y+.5,W.copy(s.vertexNormalsModel[c]).applyMatrix3(m),n=.5*W.x+.5,f=.5*W.y+.5,ce(ue,ve,re,ne,Ce,B,Fe,Xe,Ie,De,n,f,i.envMap)):(A.copy(i.color),i.vertexColors===THREE.FaceColors&&A.multiply(s.color),i.wireframe===!0?x(A,i.wireframeLinewidth,i.wireframeLinecap,i.wireframeLinejoin):h(A));else i.isMeshNormalMaterial?(W.copy(s.normalModel).applyMatrix3(m),A.setRGB(W.x,W.y,W.z).multiplyScalar(.5).addScalar(.5),i.wireframe===!0?x(A,i.wireframeLinewidth,i.wireframeLinecap,i.wireframeLinejoin):h(A)):(A.setRGB(1,1,1),i.wireframe===!0?x(A,i.wireframeLinewidth,i.wireframeLinecap,i.wireframeLinejoin):h(A))}function S(e,a,l,o,v,c){r.beginPath(),r.moveTo(e,a),r.lineTo(l,o),r.lineTo(v,c),r.closePath()}function x(e,a,l,o){fe(a),$(l),Le(o),Re(e.getStyle()),r.stroke(),g.expandByScalar(a*2)}function h(e){Y(e.getStyle()),r.fill()}function X(e){if(e.version===0||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var a=e.image;if(a.complete===!1)return{canvas:void 0,version:0};var l=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,o=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,v=e.wrapS===THREE.MirroredRepeatWrapping,c=e.wrapT===THREE.MirroredRepeatWrapping,s=document.createElement("canvas");s.width=a.width*(v?2:1),s.height=a.height*(c?2:1);var i=s.getContext("2d");i.setTransform(1,0,0,-1,0,a.height),i.drawImage(a,0,0),v===!0&&(i.setTransform(-1,0,0,-1,a.width,a.height),i.drawImage(a,-a.width,0)),c===!0&&(i.setTransform(1,0,0,1,0,0),i.drawImage(a,0,a.height)),v===!0&&c===!0&&(i.setTransform(-1,0,0,1,a.width,0),i.drawImage(a,-a.width,a.height));var H="no-repeat";l===!0&&o===!0?H="repeat":l===!0?H="repeat-x":o===!0&&(H="repeat-y");var G=r.createPattern(s,H);return e.onUpdate&&e.onUpdate(e),{canvas:G,version:e.version}}function ce(e,a,l,o,v,c,s,i,H,G,q,Z,O){var le=xe[O.id];if((le===void 0||le.version!==O.version)&&(le=X(O),xe[O.id]=le),le.canvas!==void 0)Y(le.canvas);else{Y("rgba( 0, 0, 0, 1)"),r.fill();return}var de,Pe,Te,we,Ve,ni,Je,Ge,Ke=O.offset.x/O.repeat.x,Qe=O.offset.y/O.repeat.y,Ze=O.image.width*O.repeat.x,$e=O.image.height*O.repeat.y;s=(s+Ke)*Ze,i=(i+Qe)*$e,H=(H+Ke)*Ze,G=(G+Qe)*$e,q=(q+Ke)*Ze,Z=(Z+Qe)*$e,l-=e,o-=a,v-=e,c-=a,H-=s,G-=i,q-=s,Z-=i,Je=H*Z-q*G,Je!==0&&(Ge=1/Je,de=(Z*l-G*v)*Ge,Pe=(Z*o-G*c)*Ge,Te=(H*v-q*l)*Ge,we=(H*c-q*o)*Ge,Ve=e-de*s-Te*i,ni=a-Pe*s-we*i,r.save(),r.transform(de,Pe,Te,we,Ve,ni),r.fill(),r.restore())}function I(e,a,l){var o=a.x-e.x,v=a.y-e.y,c=o*o+v*v,s;c!==0&&(s=l/Math.sqrt(c),o*=s,v*=s,a.x+=o,a.y+=v,e.x-=o,e.y-=v)}function pe(e){me!==e&&(r.globalAlpha=e,me=e)}function L(e){k!==e&&(e===THREE.NormalBlending?r.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?r.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?r.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(r.globalCompositeOperation="multiply"),k=e)}function fe(e){We!==e&&(r.lineWidth=e,We=e)}function $(e){ke!==e&&(r.lineCap=e,ke=e)}function Le(e){Ee!==e&&(r.lineJoin=e,Ee=e)}function Re(e){j!==e&&(r.strokeStyle=e,j=e)}function Y(e){Q!==e&&(r.fillStyle=e,Q=e)}function Ye(e){Ne.length!==e.length&&(r.setLineDash(e),Ne=e)}};THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0};THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0};THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0};THREE.RenderableVertex.prototype.copy=function(R){this.positionWorld.copy(R.positionWorld),this.positionScreen.copy(R.positionScreen)};THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0};THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0};THREE.Projector=function(){var R,D,J=[],te=0,K,ee,P=[],oe=0,E,z,V=[],Be=0,C,ge,be=[],ie=0,r,ae,he=[],me=0,k={objects:[],lights:[],elements:[]},j=new THREE.Vector3,Q=new THREE.Vector4,We=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),ke=new THREE.Box3,Ee=new Array(3),Ne=new THREE.Matrix4,T=new THREE.Matrix4,_,N=new THREE.Matrix4,ue=new THREE.Matrix3,ve=new THREE.Frustum,re=new THREE.Vector4,ne=new THREE.Vector4;this.projectVector=function(n,f){console.warn("THREE.Projector: .projectVector() is now vector.project()."),n.project(f)},this.unprojectVector=function(n,f){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),n.unproject(f)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var Ce=function(){var n=[],f=[],y=[],p=null,g=null,F=new THREE.Matrix3;function U(d){p=d,g=p.material,F.getNormalMatrix(p.matrixWorld),n.length=0,f.length=0,y.length=0}function u(d){var S=d.position,x=d.positionWorld,h=d.positionScreen;x.copy(S).applyMatrix4(_),h.copy(x).applyMatrix4(T);var X=1/h.w;h.x*=X,h.y*=X,h.z*=X,d.visible=h.x>=-1&&h.x<=1&&h.y>=-1&&h.y<=1&&h.z>=-1&&h.z<=1}function M(d,S,x){K=xe(),K.position.set(d,S,x),u(K)}function b(d,S,x){n.push(d,S,x)}function W(d,S,x){f.push(d,S,x)}function m(d,S){y.push(d,S)}function t(d,S,x){return d.visible===!0||S.visible===!0||x.visible===!0?!0:(Ee[0]=d.positionScreen,Ee[1]=S.positionScreen,Ee[2]=x.positionScreen,We.intersectsBox(ke.setFromPoints(Ee)))}function w(d,S,x){return(x.positionScreen.x-d.positionScreen.x)*(S.positionScreen.y-d.positionScreen.y)-(x.positionScreen.y-d.positionScreen.y)*(S.positionScreen.x-d.positionScreen.x)<0}function ye(d,S){var x=P[d],h=P[S];x.positionScreen.copy(x.position).applyMatrix4(N),h.positionScreen.copy(h.position).applyMatrix4(N),De(x.positionScreen,h.positionScreen)===!0&&(x.positionScreen.multiplyScalar(1/x.positionScreen.w),h.positionScreen.multiplyScalar(1/h.positionScreen.w),C=Fe(),C.id=p.id,C.v1.copy(x),C.v2.copy(h),C.z=Math.max(x.positionScreen.z,h.positionScreen.z),C.renderOrder=p.renderOrder,C.material=p.material,p.material.vertexColors===THREE.VertexColors&&(C.vertexColors[0].fromArray(f,d*3),C.vertexColors[1].fromArray(f,S*3)),k.elements.push(C))}function He(d,S,x){var h=P[d],X=P[S],ce=P[x];if(t(h,X,ce)!==!1&&(g.side===THREE.DoubleSide||w(h,X,ce)===!0)){E=se(),E.id=p.id,E.v1.copy(h),E.v2.copy(X),E.v3.copy(ce),E.z=(h.positionScreen.z+X.positionScreen.z+ce.positionScreen.z)/3,E.renderOrder=p.renderOrder,E.normalModel.fromArray(n,d*3),E.normalModel.applyMatrix3(F).normalize();for(var I=0;I<3;I++){var pe=E.vertexNormalsModel[I];pe.fromArray(n,arguments[I]*3),pe.applyMatrix3(F).normalize();var L=E.uvs[I];L.fromArray(y,arguments[I]*2)}E.vertexNormalsLength=3,E.material=p.material,k.elements.push(E)}}return{setObject:U,projectVertex:u,checkTriangleVisibility:t,checkBackfaceCulling:w,pushVertex:M,pushNormal:b,pushColor:W,pushUv:m,pushLine:ye,pushTriangle:He}},B=new Ce;function A(n){if(n.visible!==!1){if(n instanceof THREE.Light)k.lights.push(n);else if(n instanceof THREE.Mesh||n instanceof THREE.Line||n instanceof THREE.Points){if(n.material.visible===!1||n.frustumCulled===!0&&ve.intersectsObject(n)===!1)return;_e(n)}else if(n instanceof THREE.Sprite){if(n.material.visible===!1||n.frustumCulled===!0&&ve.intersectsSprite(n)===!1)return;_e(n)}for(var f=n.children,y=0,p=f.length;y<p;y++)A(f[y])}}function _e(n){R=Ae(),R.id=n.id,R.object=n,j.setFromMatrixPosition(n.matrixWorld),j.applyMatrix4(T),R.z=j.z,R.renderOrder=n.renderOrder,k.objects.push(R)}this.projectScene=function(n,f,y,p){z=0,ge=0,ae=0,k.elements.length=0,n.autoUpdate===!0&&n.updateMatrixWorld(),f.parent===null&&f.updateMatrixWorld(),Ne.copy(f.matrixWorldInverse),T.multiplyMatrices(f.projectionMatrix,Ne),ve.setFromMatrix(T),D=0,k.objects.length=0,k.lights.length=0,A(n),y===!0&&k.objects.sort(Ie);for(var g=k.objects,F=0,U=g.length;F<U;F++){var u=g[F].object,M=u.geometry;if(B.setObject(u),_=u.matrixWorld,ee=0,u instanceof THREE.Mesh){if(M instanceof THREE.BufferGeometry){var b=M.attributes,W=M.groups;if(b.position===void 0)continue;for(var m=b.position.array,t=0,w=m.length;t<w;t+=3)B.pushVertex(m[t],m[t+1],m[t+2]);if(b.normal!==void 0)for(var ye=b.normal.array,t=0,w=ye.length;t<w;t+=3)B.pushNormal(ye[t],ye[t+1],ye[t+2]);if(b.uv!==void 0)for(var He=b.uv.array,t=0,w=He.length;t<w;t+=2)B.pushUv(He[t],He[t+1]);if(M.index!==null){var d=M.index.array;if(W.length>0)for(var S=0;S<W.length;S++)for(var x=W[S],t=x.start,w=x.start+x.count;t<w;t+=3)B.pushTriangle(d[t],d[t+1],d[t+2]);else for(var t=0,w=d.length;t<w;t+=3)B.pushTriangle(d[t],d[t+1],d[t+2])}else for(var t=0,w=m.length/3;t<w;t+=3)B.pushTriangle(t,t+1,t+2)}else if(M instanceof THREE.Geometry){var h=M.vertices,X=M.faces,ce=M.faceVertexUvs[0];ue.getNormalMatrix(_);for(var I=u.material,pe=Array.isArray(I),L=0,fe=h.length;L<fe;L++){var $=h[L];if(j.copy($),I.morphTargets===!0)for(var Le=M.morphTargets,Re=u.morphTargetInfluences,Y=0,Ye=Le.length;Y<Ye;Y++){var e=Re[Y];if(e!==0){var a=Le[Y],l=a.vertices[L];j.x+=(l.x-$.x)*e,j.y+=(l.y-$.y)*e,j.z+=(l.z-$.z)*e}}B.pushVertex(j.x,j.y,j.z)}for(var o=0,v=X.length;o<v;o++){var c=X[o];if(I=pe===!0?u.material[c.materialIndex]:u.material,I!==void 0){var s=I.side,i=P[c.a],H=P[c.b],G=P[c.c];if(B.checkTriangleVisibility(i,H,G)!==!1){var q=B.checkBackfaceCulling(i,H,G);if(!(s!==THREE.DoubleSide&&(s===THREE.FrontSide&&q===!1||s===THREE.BackSide&&q===!0))){E=se(),E.id=u.id,E.v1.copy(i),E.v2.copy(H),E.v3.copy(G),E.normalModel.copy(c.normal),q===!1&&(s===THREE.BackSide||s===THREE.DoubleSide)&&E.normalModel.negate(),E.normalModel.applyMatrix3(ue).normalize();for(var Z=c.vertexNormals,O=0,le=Math.min(Z.length,3);O<le;O++){var de=E.vertexNormalsModel[O];de.copy(Z[O]),q===!1&&(s===THREE.BackSide||s===THREE.DoubleSide)&&de.negate(),de.applyMatrix3(ue).normalize()}E.vertexNormalsLength=Z.length;var Pe=ce[o];if(Pe!==void 0)for(var Te=0;Te<3;Te++)E.uvs[Te].copy(Pe[Te]);E.color=c.color,E.material=I,E.z=(i.positionScreen.z+H.positionScreen.z+G.positionScreen.z)/3,E.renderOrder=u.renderOrder,k.elements.push(E)}}}}}}else if(u instanceof THREE.Line){if(N.multiplyMatrices(T,_),M instanceof THREE.BufferGeometry){var b=M.attributes;if(b.position!==void 0){for(var m=b.position.array,t=0,w=m.length;t<w;t+=3)B.pushVertex(m[t],m[t+1],m[t+2]);if(b.color!==void 0)for(var we=b.color.array,t=0,w=we.length;t<w;t+=3)B.pushColor(we[t],we[t+1],we[t+2]);if(M.index!==null)for(var d=M.index.array,t=0,w=d.length;t<w;t+=2)B.pushLine(d[t],d[t+1]);else for(var Ve=u instanceof THREE.LineSegments?2:1,t=0,w=m.length/3-1;t<w;t+=Ve)B.pushLine(t,t+1)}}else if(M instanceof THREE.Geometry){var h=u.geometry.vertices;if(h.length===0)continue;i=xe(),i.positionScreen.copy(h[0]).applyMatrix4(N);for(var Ve=u instanceof THREE.LineSegments?2:1,L=1,fe=h.length;L<fe;L++)i=xe(),i.positionScreen.copy(h[L]).applyMatrix4(N),!((L+1)%Ve>0)&&(H=P[ee-2],re.copy(i.positionScreen),ne.copy(H.positionScreen),De(re,ne)===!0&&(re.multiplyScalar(1/re.w),ne.multiplyScalar(1/ne.w),C=Fe(),C.id=u.id,C.v1.positionScreen.copy(re),C.v2.positionScreen.copy(ne),C.z=Math.max(re.z,ne.z),C.renderOrder=u.renderOrder,C.material=u.material,u.material.vertexColors===THREE.VertexColors&&(C.vertexColors[0].copy(u.geometry.colors[L]),C.vertexColors[1].copy(u.geometry.colors[L-1])),k.elements.push(C)))}}else if(u instanceof THREE.Points){if(N.multiplyMatrices(T,_),M instanceof THREE.Geometry)for(var h=u.geometry.vertices,L=0,fe=h.length;L<fe;L++){var $=h[L];Q.set($.x,$.y,$.z,1),Q.applyMatrix4(N),ze(Q,u,f)}else if(M instanceof THREE.BufferGeometry){var b=M.attributes;if(b.position!==void 0)for(var m=b.position.array,t=0,w=m.length;t<w;t+=3)Q.set(m[t],m[t+1],m[t+2],1),Q.applyMatrix4(N),ze(Q,u,f)}}else u instanceof THREE.Sprite&&(Q.set(_.elements[12],_.elements[13],_.elements[14],1),Q.applyMatrix4(T),ze(Q,u,f))}return p===!0&&k.elements.sort(Ie),k};function ze(n,f,y){var p=1/n.w;n.z*=p,n.z>=-1&&n.z<=1&&(r=Xe(),r.id=f.id,r.x=n.x*p,r.y=n.y*p,r.z=n.z,r.renderOrder=f.renderOrder,r.object=f,r.rotation=f.rotation,r.scale.x=f.scale.x*Math.abs(r.x-(n.x+y.projectionMatrix.elements[0])/(n.w+y.projectionMatrix.elements[12])),r.scale.y=f.scale.y*Math.abs(r.y-(n.y+y.projectionMatrix.elements[5])/(n.w+y.projectionMatrix.elements[13])),r.material=f.material,k.elements.push(r))}function Ae(){if(D===te){var n=new THREE.RenderableObject;return J.push(n),te++,D++,n}return J[D++]}function xe(){if(ee===oe){var n=new THREE.RenderableVertex;return P.push(n),oe++,ee++,n}return P[ee++]}function se(){if(z===Be){var n=new THREE.RenderableFace;return V.push(n),Be++,z++,n}return V[z++]}function Fe(){if(ge===ie){var n=new THREE.RenderableLine;return be.push(n),ie++,ge++,n}return be[ge++]}function Xe(){if(ae===me){var n=new THREE.RenderableSprite;return he.push(n),me++,ae++,n}return he[ae++]}function Ie(n,f){return n.renderOrder!==f.renderOrder?n.renderOrder-f.renderOrder:n.z!==f.z?f.z-n.z:n.id!==f.id?n.id-f.id:0}function De(n,f){var y=0,p=1,g=n.z+n.w,F=f.z+f.w,U=-n.z+n.w,u=-f.z+f.w;return g>=0&&F>=0&&U>=0&&u>=0?!0:g<0&&F<0||U<0&&u<0?!1:(g<0?y=Math.max(y,g/(g-F)):F<0&&(p=Math.min(p,g/(g-F))),U<0?y=Math.max(y,U/(U-u)):u<0&&(p=Math.min(p,U/(U-u))),p<y?!1:(n.lerp(f,y),f.lerp(n,1-p),!0))}};var qe=200,ei=40,ii=60,ti,Oe,Ue,Me,ri,Se,je=0;function ci(){ai(),oi()}function ai(){ti=document.querySelector("#home_wave"),Oe=new THREE.PerspectiveCamera(65,window.innerWidth/window.innerHeight,1,1e4),Oe.position.z=1e4,Ue=new THREE.Scene,Ue.fog=new THREE.Fog(1645341,2e3,1e4),ri=new Array;for(var R=Math.PI*2,D=new THREE.SpriteCanvasMaterial({color:16777215,program:function(ee){ee.beginPath(),ee.arc(0,0,.5,0,R,!0),ee.fill()}}),J=0,te=0;te<ei;te++)for(var K=0;K<ii;K++)Se=ri[J++]=new THREE.Sprite(D),Se.position.x=te*qe-ei*qe/2,Se.position.z=K*qe-ii*qe/2,Ue.add(Se);Me=new THREE.CanvasRenderer({alpha:!0}),Me.setPixelRatio(window.devicePixelRatio),Me.setSize(window.innerWidth,window.innerHeight),Me.setClearColor(Ue.fog.color),ti.append(Me.domElement),window.addEventListener("resize",si,!1)}function si(){Oe.aspect=window.innerWidth/window.innerHeight,Oe.updateProjectionMatrix(),Me.setSize(window.innerWidth,window.innerHeight)}function oi(){requestAnimationFrame(oi),li()}function li(){Oe.position.set(0,355,122);for(var R=0,D=0;D<ei;D++)for(var J=0;J<ii;J++)Se=ri[R++],Se.position.y=Math.sin((D+je)*.3)*50+Math.sin((J+je)*.5)*50,Se.scale.x=Se.scale.y=(Math.sin((D+je)*.3)+1)*4+(Math.sin((J+je)*.5)+1)*4;Me.render(Ue,Oe),je+=.1}export{ci as default};
